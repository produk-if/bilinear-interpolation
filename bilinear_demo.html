<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilinear Interpolation - Visual Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .header {
            background: linear-gradient(90deg, #0f3460, #533483);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            color: #a0a0a0;
            font-size: 1.1em;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .panel h2 {
            color: #00d9ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2 .icon {
            font-size: 1.5em;
        }
        
        /* Canvas Area */
        .canvas-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .canvas-box {
            text-align: center;
        }
        
        .canvas-box h3 {
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        canvas {
            border: 2px solid #00d9ff;
            border-radius: 8px;
            cursor: crosshair;
        }
        
        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group label {
            color: #a0a0a0;
        }
        
        input[type="range"] {
            width: 150px;
            accent-color: #00d9ff;
        }
        
        input[type="number"] {
            width: 70px;
            padding: 5px;
            border: 1px solid #00d9ff;
            border-radius: 5px;
            background: #1a1a2e;
            color: #fff;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00d9ff, #0099cc);
            color: #000;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,217,255,0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #ffd700, #ff9500);
            color: #000;
        }
        
        /* Code Display */
        .code-container {
            background: #0d1117;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .code-header {
            background: #161b22;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #30363d;
        }
        
        .code-header span {
            color: #8b949e;
            font-size: 0.9em;
        }
        
        .code-tabs {
            display: flex;
            gap: 5px;
        }
        
        .code-tab {
            padding: 5px 15px;
            background: transparent;
            color: #8b949e;
            border: 1px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .code-tab.active {
            background: #0d1117;
            color: #fff;
            border-color: #30363d;
        }
        
        pre {
            padding: 15px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .keyword { color: #ff7b72; }
        .type { color: #79c0ff; }
        .function { color: #d2a8ff; }
        .number { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .string { color: #a5d6ff; }
        .operator { color: #ff7b72; }
        
        /* Step Display */
        .step-container {
            background: rgba(0,217,255,0.1);
            border: 1px solid #00d9ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .step-title {
            color: #00d9ff;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .step-content {
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .highlight-yellow { color: #ffd700; font-weight: bold; }
        .highlight-green { color: #00ff88; font-weight: bold; }
        .highlight-cyan { color: #00d9ff; }
        .highlight-pink { color: #ff79c6; }
        
        /* Formula Box */
        .formula-box {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,150,0,0.1));
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        
        .formula-box h3 {
            color: #ffd700;
            margin-bottom: 15px;
        }
        
        .formula {
            font-family: 'Times New Roman', serif;
            font-size: 1.3em;
            color: #fff;
        }
        
        /* Grid Display */
        .pixel-grid {
            display: inline-grid;
            gap: 2px;
            background: #333;
            padding: 2px;
            border-radius: 5px;
        }
        
        .pixel-cell {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        .pixel-cell.highlight {
            border: 3px solid #00ff88;
            transform: scale(1.1);
        }
        
        /* Navigation */
        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .step-indicator {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #00d9ff;
            transition: all 0.3s;
        }
        
        .step-dot.active {
            background: #00d9ff;
            box-shadow: 0 0 10px #00d9ff;
        }
        
        .step-dot.completed {
            background: #00ff88;
            border-color: #00ff88;
        }
        
        /* Info boxes */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .info-box {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-box .label {
            color: #8b949e;
            font-size: 0.85em;
        }
        
        .info-box .value {
            color: #00ff88;
            font-size: 1.5em;
            font-weight: bold;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ–¼ï¸ Bilinear Interpolation</h1>
        <p>Visual Step-by-Step Demo | Algoritma Komputasi S2 - 2025</p>
    </div>
    
    <div class="container">
        <div class="main-grid">
            <!-- Left Panel: Visualization -->
            <div class="panel">
                <h2><span class="icon">ğŸ“Š</span> Visualisasi Interaktif</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label>X:</label>
                        <input type="range" id="xCoord" min="0" max="2.99" step="0.01" value="1.5">
                        <input type="number" id="xValue" value="1.5" step="0.1" min="0" max="2.99">
                    </div>
                    <div class="control-group">
                        <label>Y:</label>
                        <input type="range" id="yCoord" min="0" max="2.99" step="0.01" value="1.5">
                        <input type="number" id="yValue" value="1.5" step="0.1" min="0" max="2.99">
                    </div>
                </div>
                
                <div class="canvas-container">
                    <div class="canvas-box">
                        <h3>Source Image (4Ã—4)</h3>
                        <canvas id="sourceCanvas" width="240" height="240"></canvas>
                    </div>
                    <div class="canvas-box">
                        <h3>Interpolation View</h3>
                        <canvas id="zoomCanvas" width="240" height="240"></canvas>
                    </div>
                </div>
                
                <div class="info-grid">
                    <div class="info-box">
                        <div class="label">Koordinat Target</div>
                        <div class="value" id="coordDisplay">(1.50, 1.50)</div>
                    </div>
                    <div class="info-box">
                        <div class="label">Hasil Interpolasi</div>
                        <div class="value" id="resultDisplay">85.00</div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <h3>ğŸ“ Formula Bilinear Interpolation</h3>
                    <div class="formula">
                        f(x,y) = fâ‚€â‚€Â·wâ‚€â‚€ + fâ‚â‚€Â·wâ‚â‚€ + fâ‚€â‚Â·wâ‚€â‚ + fâ‚â‚Â·wâ‚â‚
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn-primary" onclick="startStepByStep()">â–¶ï¸ Mulai Step-by-Step</button>
                    <button class="btn-secondary" onclick="resetDemo()">ğŸ”„ Reset</button>
                </div>
                
                <div class="step-indicator">
                    <div class="step-dot" id="dot0"></div>
                    <div class="step-dot" id="dot1"></div>
                    <div class="step-dot" id="dot2"></div>
                    <div class="step-dot" id="dot3"></div>
                    <div class="step-dot" id="dot4"></div>
                </div>
                
                <div class="step-container" id="stepContainer">
                    <div class="step-title" id="stepTitle">Klik "Mulai Step-by-Step" untuk melihat proses</div>
                    <div class="step-content" id="stepContent">
                        Geser slider X dan Y untuk memilih koordinat, lalu klik tombol untuk melihat proses interpolasi step-by-step.
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Source Code -->
            <div class="panel">
                <h2><span class="icon">ğŸ’»</span> Source Code C++</h2>
                
                <div class="code-container">
                    <div class="code-header">
                        <div class="code-tabs">
                            <button class="code-tab active" onclick="showCode('interpolate')">interpolate()</button>
                            <button class="code-tab" onclick="showCode('weights')">weights</button>
                            <button class="code-tab" onclick="showCode('resize')">resize()</button>
                            <button class="code-tab" onclick="showCode('full')">Full Code</button>
                        </div>
                        <span>bilinear.cpp</span>
                    </div>
                    <pre id="codeDisplay"></pre>
                </div>
                
                <div class="step-container" style="margin-top: 20px; background: rgba(255,215,0,0.1); border-color: #ffd700;">
                    <div class="step-title" style="color: #ffd700;">ğŸ“ Perhitungan Real-time</div>
                    <div class="step-content" id="calcDisplay">
                        <!-- Real-time calculation will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================================
        // IMAGE DATA
        // ============================================================
        const sourceImage = [
            [10,  30,  50,  70],
            [40,  60,  80, 100],
            [70,  90, 110, 130],
            [100, 120, 140, 160]
        ];
        
        // ============================================================
        // SOURCE CODE SNIPPETS
        // ============================================================
        const codeSnippets = {
            interpolate: `<span class="comment">// Bilinear Interpolation - Main Function</span>
<span class="type">Pixel</span> <span class="function">BilinearInterpolation::interpolate</span>(
    <span class="keyword">const</span> <span class="type">Image</span>& image, 
    <span class="type">float</span> x, <span class="type">float</span> y) <span class="keyword">const</span> 
{
    <span class="comment">// Step 1: Clamp coordinates</span>
    x = <span class="function">max</span>(<span class="number">0.0f</span>, <span class="function">min</span>(x, (<span class="type">float</span>)image.<span class="function">getWidth</span>() - <span class="number">1.001f</span>));
    y = <span class="function">max</span>(<span class="number">0.0f</span>, <span class="function">min</span>(y, (<span class="type">float</span>)image.<span class="function">getHeight</span>() - <span class="number">1.001f</span>));
    
    <span class="comment">// Step 2: Get integer coordinates (4 neighbors)</span>
    <span class="type">int</span> x0 = (<span class="type">int</span>)<span class="function">floor</span>(x);
    <span class="type">int</span> y0 = (<span class="type">int</span>)<span class="function">floor</span>(y);
    <span class="type">int</span> x1 = <span class="function">min</span>(x0 + <span class="number">1</span>, image.<span class="function">getWidth</span>() - <span class="number">1</span>);
    <span class="type">int</span> y1 = <span class="function">min</span>(y0 + <span class="number">1</span>, image.<span class="function">getHeight</span>() - <span class="number">1</span>);
    
    <span class="comment">// Step 3: Get fractional parts</span>
    <span class="type">float</span> fx = x - <span class="function">floor</span>(x);
    <span class="type">float</span> fy = y - <span class="function">floor</span>(y);
    
    <span class="comment">// Step 4: Get 4 pixel values</span>
    <span class="type">Pixel</span> f00 = image.<span class="function">getPixel</span>(x0, y0);  <span class="comment">// Top-Left</span>
    <span class="type">Pixel</span> f10 = image.<span class="function">getPixel</span>(x1, y0);  <span class="comment">// Top-Right</span>
    <span class="type">Pixel</span> f01 = image.<span class="function">getPixel</span>(x0, y1);  <span class="comment">// Bottom-Left</span>
    <span class="type">Pixel</span> f11 = image.<span class="function">getPixel</span>(x1, y1);  <span class="comment">// Bottom-Right</span>
    
    <span class="comment">// Step 5: Compute weights</span>
    <span class="type">float</span> w00 = (<span class="number">1.0f</span> - fx) * (<span class="number">1.0f</span> - fy);
    <span class="type">float</span> w10 = fx * (<span class="number">1.0f</span> - fy);
    <span class="type">float</span> w01 = (<span class="number">1.0f</span> - fx) * fy;
    <span class="type">float</span> w11 = fx * fy;
    
    <span class="comment">// Step 6: Weighted sum</span>
    <span class="type">Pixel</span> result(
        f00.r * w00 + f10.r * w10 + f01.r * w01 + f11.r * w11,
        f00.g * w00 + f10.g * w10 + f01.g * w01 + f11.g * w11,
        f00.b * w00 + f10.b * w10 + f01.b * w01 + f11.b * w11
    );
    
    <span class="keyword">return</span> result;
}`,
            
            weights: `<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// WEIGHT CALCULATION - Inti dari Bilinear Interpolation</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="comment">// Fractional coordinates (jarak dari tepi kiri/atas)</span>
<span class="type">float</span> fx = x - <span class="function">floor</span>(x);  <span class="comment">// horizontal fraction</span>
<span class="type">float</span> fy = y - <span class="function">floor</span>(y);  <span class="comment">// vertical fraction</span>

<span class="comment">// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="comment">// â”‚  FORMULA BOBOT (WEIGHTS):                         â”‚</span>
<span class="comment">// â”‚                                                    â”‚</span>
<span class="comment">// â”‚  w00 = (1-fx) Ã— (1-fy)  â† Kiri-Atas               â”‚</span>
<span class="comment">// â”‚  w10 =   fx   Ã— (1-fy)  â† Kanan-Atas              â”‚</span>
<span class="comment">// â”‚  w01 = (1-fx) Ã—   fy    â† Kiri-Bawah              â”‚</span>
<span class="comment">// â”‚  w11 =   fx   Ã—   fy    â† Kanan-Bawah             â”‚</span>
<span class="comment">// â”‚                                                    â”‚</span>
<span class="comment">// â”‚  PROPERTI: w00 + w10 + w01 + w11 = 1              â”‚</span>
<span class="comment">// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="type">float</span> w00 = (<span class="number">1.0f</span> - fx) * (<span class="number">1.0f</span> - fy);
<span class="type">float</span> w10 = fx * (<span class="number">1.0f</span> - fy);
<span class="type">float</span> w01 = (<span class="number">1.0f</span> - fx) * fy;
<span class="type">float</span> w11 = fx * fy;

<span class="comment">// Visualisasi geometri:</span>
<span class="comment">//</span>
<span class="comment">//   (x0,y0)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(x1,y0)</span>
<span class="comment">//      â”‚                      â”‚</span>
<span class="comment">//      â”‚       fy             â”‚</span>
<span class="comment">//      â”‚        â†‘             â”‚</span>
<span class="comment">//      â”‚        â”‚             â”‚</span>
<span class="comment">//      â”‚        â—â”€â”€â”€â†’ fx      â”‚</span>
<span class="comment">//      â”‚     (x,y)            â”‚</span>
<span class="comment">//      â”‚                      â”‚</span>
<span class="comment">//   (x0,y1)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(x1,y1)</span>`,

            resize: `<span class="comment">// Image Resize menggunakan Bilinear Interpolation</span>
<span class="type">Image</span> <span class="function">BilinearInterpolation::resize_serial</span>(
    <span class="keyword">const</span> <span class="type">Image</span>& src, 
    <span class="type">int</span> new_height, 
    <span class="type">int</span> new_width) <span class="keyword">const</span> 
{
    <span class="type">Image</span> dst(new_height, new_width);
    
    <span class="comment">// Hitung scale factor</span>
    <span class="type">float</span> scale_y = (<span class="type">float</span>)src.<span class="function">getHeight</span>() / new_height;
    <span class="type">float</span> scale_x = (<span class="type">float</span>)src.<span class="function">getWidth</span>() / new_width;
    
    <span class="comment">// Loop setiap pixel di destination</span>
    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j < new_height; j++) {
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i < new_width; i++) {
            
            <span class="comment">// Mapping: dst coordinate â†’ src coordinate</span>
            <span class="type">float</span> src_x = i * scale_x;
            <span class="type">float</span> src_y = j * scale_y;
            
            <span class="comment">// Interpolasi pada posisi float</span>
            <span class="type">Pixel</span> pixel = <span class="function">interpolate</span>(src, src_x, src_y);
            
            <span class="comment">// Set pixel di destination</span>
            dst.<span class="function">setPixel</span>(i, j, pixel);
        }
    }
    
    <span class="keyword">return</span> dst;
}

<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// OpenMP Parallel Version</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="type">Image</span> <span class="function">resize_openmp</span>(...) {
    <span class="keyword">#pragma omp parallel for collapse(2)</span>
    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j < new_height; j++) {
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i < new_width; i++) {
            <span class="comment">// Same logic, parallelized</span>
        }
    }
}`,

            full: `<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<span class="comment">// BILINEAR INTERPOLATION - FULL IMPLEMENTATION</span>
<span class="comment">// Algoritma Komputasi S2 - 2025</span>
<span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="keyword">#include</span> <span class="string">&lt;cmath&gt;</span>
<span class="keyword">#include</span> <span class="string">&lt;algorithm&gt;</span>

<span class="keyword">struct</span> <span class="type">Pixel</span> {
    <span class="type">float</span> r, g, b, a;
    <span class="function">Pixel</span>(<span class="type">float</span> r=<span class="number">0</span>, <span class="type">float</span> g=<span class="number">0</span>, <span class="type">float</span> b=<span class="number">0</span>, <span class="type">float</span> a=<span class="number">255</span>) 
        : r(r), g(g), b(b), a(a) {}
};

<span class="keyword">class</span> <span class="type">BilinearInterpolation</span> {
<span class="keyword">public</span>:
    <span class="comment">// Main interpolation function</span>
    <span class="type">Pixel</span> <span class="function">interpolate</span>(<span class="keyword">const</span> <span class="type">Image</span>& img, <span class="type">float</span> x, <span class="type">float</span> y) {
        <span class="comment">// 1. Find 4 neighbors</span>
        <span class="type">int</span> x0 = (<span class="type">int</span>)<span class="function">floor</span>(x);
        <span class="type">int</span> y0 = (<span class="type">int</span>)<span class="function">floor</span>(y);
        <span class="type">int</span> x1 = x0 + <span class="number">1</span>;
        <span class="type">int</span> y1 = y0 + <span class="number">1</span>;
        
        <span class="comment">// 2. Get fractional parts</span>
        <span class="type">float</span> fx = x - x0;
        <span class="type">float</span> fy = y - y0;
        
        <span class="comment">// 3. Get pixel values</span>
        <span class="type">Pixel</span> f00 = img.<span class="function">at</span>(x0, y0);
        <span class="type">Pixel</span> f10 = img.<span class="function">at</span>(x1, y0);
        <span class="type">Pixel</span> f01 = img.<span class="function">at</span>(x0, y1);
        <span class="type">Pixel</span> f11 = img.<span class="function">at</span>(x1, y1);
        
        <span class="comment">// 4. Calculate weights</span>
        <span class="type">float</span> w00 = (<span class="number">1</span>-fx) * (<span class="number">1</span>-fy);
        <span class="type">float</span> w10 = fx * (<span class="number">1</span>-fy);
        <span class="type">float</span> w01 = (<span class="number">1</span>-fx) * fy;
        <span class="type">float</span> w11 = fx * fy;
        
        <span class="comment">// 5. Weighted sum</span>
        <span class="keyword">return</span> <span class="type">Pixel</span>(
            f00.r*w00 + f10.r*w10 + f01.r*w01 + f11.r*w11,
            f00.g*w00 + f10.g*w10 + f01.g*w01 + f11.g*w11,
            f00.b*w00 + f10.b*w10 + f01.b*w01 + f11.b*w11
        );
    }
};`
        };
        
        // ============================================================
        // CANVAS DRAWING
        // ============================================================
        const sourceCanvas = document.getElementById('sourceCanvas');
        const zoomCanvas = document.getElementById('zoomCanvas');
        const srcCtx = sourceCanvas.getContext('2d');
        const zoomCtx = zoomCanvas.getContext('2d');
        
        let currentX = 1.5;
        let currentY = 1.5;
        let currentStep = -1;
        
        function valueToColor(val) {
            const normalized = val / 160;
            const r = Math.floor(50 + normalized * 180);
            const g = Math.floor(100 + normalized * 100);
            const b = Math.floor(150 + normalized * 80);
            return `rgb(${r},${g},${b})`;
        }
        
        function drawSourceImage() {
            const cellSize = 60;
            srcCtx.clearRect(0, 0, 240, 240);
            
            // Calculate neighbors
            const x0 = Math.floor(currentX);
            const y0 = Math.floor(currentY);
            const x1 = Math.min(x0 + 1, 3);
            const y1 = Math.min(y0 + 1, 3);
            
            // Draw cells
            for (let j = 0; j < 4; j++) {
                for (let i = 0; i < 4; i++) {
                    const val = sourceImage[j][i];
                    const isNeighbor = (i === x0 && j === y0) || (i === x1 && j === y0) ||
                                      (i === x0 && j === y1) || (i === x1 && j === y1);
                    
                    // Cell background
                    srcCtx.fillStyle = valueToColor(val);
                    srcCtx.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
                    
                    // Highlight neighbors
                    if (isNeighbor) {
                        srcCtx.strokeStyle = '#00ff88';
                        srcCtx.lineWidth = 4;
                        srcCtx.strokeRect(i * cellSize + 2, j * cellSize + 2, cellSize - 4, cellSize - 4);
                    }
                    
                    // Cell border
                    srcCtx.strokeStyle = '#333';
                    srcCtx.lineWidth = 1;
                    srcCtx.strokeRect(i * cellSize, j * cellSize, cellSize, cellSize);
                    
                    // Value text
                    srcCtx.fillStyle = val > 80 ? '#000' : '#fff';
                    srcCtx.font = 'bold 14px Arial';
                    srcCtx.textAlign = 'center';
                    srcCtx.fillText(val, i * cellSize + cellSize/2, j * cellSize + cellSize/2 + 5);
                }
            }
            
            // Draw target point
            const px = currentX * cellSize;
            const py = currentY * cellSize;
            
            srcCtx.beginPath();
            srcCtx.arc(px, py, 8, 0, Math.PI * 2);
            srcCtx.fillStyle = '#ff0066';
            srcCtx.fill();
            srcCtx.strokeStyle = '#fff';
            srcCtx.lineWidth = 2;
            srcCtx.stroke();
            
            // Crosshair
            srcCtx.strokeStyle = '#ff0066';
            srcCtx.setLineDash([5, 5]);
            srcCtx.beginPath();
            srcCtx.moveTo(px, 0);
            srcCtx.lineTo(px, 240);
            srcCtx.moveTo(0, py);
            srcCtx.lineTo(240, py);
            srcCtx.stroke();
            srcCtx.setLineDash([]);
        }
        
        function drawZoomView() {
            zoomCtx.clearRect(0, 0, 240, 240);
            
            const x0 = Math.floor(currentX);
            const y0 = Math.floor(currentY);
            const x1 = Math.min(x0 + 1, 3);
            const y1 = Math.min(y0 + 1, 3);
            
            const fx = currentX - x0;
            const fy = currentY - y0;
            
            // Draw the 4 neighbor cells (zoomed)
            const cellSize = 100;
            const offset = 20;
            
            const neighbors = [
                {x: 0, y: 0, val: sourceImage[y0][x0], label: 'f00'},
                {x: 1, y: 0, val: sourceImage[y0][x1], label: 'f10'},
                {x: 0, y: 1, val: sourceImage[y1][x0], label: 'f01'},
                {x: 1, y: 1, val: sourceImage[y1][x1], label: 'f11'}
            ];
            
            neighbors.forEach(n => {
                const px = offset + n.x * cellSize;
                const py = offset + n.y * cellSize;
                
                zoomCtx.fillStyle = valueToColor(n.val);
                zoomCtx.fillRect(px, py, cellSize, cellSize);
                
                zoomCtx.strokeStyle = '#00d9ff';
                zoomCtx.lineWidth = 2;
                zoomCtx.strokeRect(px, py, cellSize, cellSize);
                
                // Value
                zoomCtx.fillStyle = '#fff';
                zoomCtx.font = 'bold 16px Arial';
                zoomCtx.textAlign = 'center';
                zoomCtx.fillText(n.val, px + cellSize/2, py + cellSize/2);
                
                // Label
                zoomCtx.fillStyle = '#ffd700';
                zoomCtx.font = '12px Arial';
                zoomCtx.fillText(n.label, px + cellSize/2, py + 20);
            });
            
            // Draw interpolation point
            const targetX = offset + fx * cellSize + cellSize * (fx > 0.5 ? 0 : 0);
            const targetY = offset + fy * cellSize + cellSize * (fy > 0.5 ? 0 : 0);
            const actualX = offset + fx * cellSize;
            const actualY = offset + fy * cellSize;
            
            // Draw distance lines
            zoomCtx.strokeStyle = '#ff0066';
            zoomCtx.lineWidth = 2;
            zoomCtx.setLineDash([5, 5]);
            
            // Horizontal line (fx)
            zoomCtx.beginPath();
            zoomCtx.moveTo(offset, actualY);
            zoomCtx.lineTo(actualX, actualY);
            zoomCtx.stroke();
            
            // Vertical line (fy)
            zoomCtx.beginPath();
            zoomCtx.moveTo(actualX, offset);
            zoomCtx.lineTo(actualX, actualY);
            zoomCtx.stroke();
            
            zoomCtx.setLineDash([]);
            
            // Target point
            zoomCtx.beginPath();
            zoomCtx.arc(actualX, actualY, 10, 0, Math.PI * 2);
            zoomCtx.fillStyle = '#ff0066';
            zoomCtx.fill();
            zoomCtx.strokeStyle = '#fff';
            zoomCtx.lineWidth = 3;
            zoomCtx.stroke();
            
            // Labels for fx, fy
            zoomCtx.fillStyle = '#00ff88';
            zoomCtx.font = 'bold 14px Arial';
            zoomCtx.fillText(`fx=${fx.toFixed(2)}`, offset + fx * cellSize / 2, actualY - 10);
            zoomCtx.fillText(`fy=${fy.toFixed(2)}`, actualX + 10, offset + fy * cellSize / 2);
        }
        
        function calculateInterpolation() {
            const x0 = Math.floor(currentX);
            const y0 = Math.floor(currentY);
            const x1 = Math.min(x0 + 1, 3);
            const y1 = Math.min(y0 + 1, 3);
            
            const fx = currentX - x0;
            const fy = currentY - y0;
            
            const f00 = sourceImage[y0][x0];
            const f10 = sourceImage[y0][x1];
            const f01 = sourceImage[y1][x0];
            const f11 = sourceImage[y1][x1];
            
            const w00 = (1 - fx) * (1 - fy);
            const w10 = fx * (1 - fy);
            const w01 = (1 - fx) * fy;
            const w11 = fx * fy;
            
            const result = f00 * w00 + f10 * w10 + f01 * w01 + f11 * w11;
            
            return { x0, y0, x1, y1, fx, fy, f00, f10, f01, f11, w00, w10, w01, w11, result };
        }
        
        function updateCalculationDisplay() {
            const calc = calculateInterpolation();
            
            document.getElementById('coordDisplay').textContent = 
                `(${currentX.toFixed(2)}, ${currentY.toFixed(2)})`;
            document.getElementById('resultDisplay').textContent = 
                calc.result.toFixed(2);
            
            const calcHTML = `
<span class="highlight-cyan">// Neighbors:</span>
f00 = image[${calc.y0}][${calc.x0}] = <span class="highlight-yellow">${calc.f00}</span>
f10 = image[${calc.y0}][${calc.x1}] = <span class="highlight-yellow">${calc.f10}</span>
f01 = image[${calc.y1}][${calc.x0}] = <span class="highlight-yellow">${calc.f01}</span>
f11 = image[${calc.y1}][${calc.x1}] = <span class="highlight-yellow">${calc.f11}</span>

<span class="highlight-cyan">// Fractions:</span>
fx = ${currentX.toFixed(2)} - ${calc.x0} = <span class="highlight-green">${calc.fx.toFixed(4)}</span>
fy = ${currentY.toFixed(2)} - ${calc.y0} = <span class="highlight-green">${calc.fy.toFixed(4)}</span>

<span class="highlight-cyan">// Weights:</span>
w00 = (1-${calc.fx.toFixed(2)}) Ã— (1-${calc.fy.toFixed(2)}) = <span class="highlight-pink">${calc.w00.toFixed(4)}</span>
w10 = ${calc.fx.toFixed(2)} Ã— (1-${calc.fy.toFixed(2)}) = <span class="highlight-pink">${calc.w10.toFixed(4)}</span>
w01 = (1-${calc.fx.toFixed(2)}) Ã— ${calc.fy.toFixed(2)} = <span class="highlight-pink">${calc.w01.toFixed(4)}</span>
w11 = ${calc.fx.toFixed(2)} Ã— ${calc.fy.toFixed(2)} = <span class="highlight-pink">${calc.w11.toFixed(4)}</span>

<span class="highlight-cyan">// Result:</span>
f(x,y) = ${calc.f00}Ã—${calc.w00.toFixed(3)} + ${calc.f10}Ã—${calc.w10.toFixed(3)} + ${calc.f01}Ã—${calc.w01.toFixed(3)} + ${calc.f11}Ã—${calc.w11.toFixed(3)}
       = ${(calc.f00*calc.w00).toFixed(2)} + ${(calc.f10*calc.w10).toFixed(2)} + ${(calc.f01*calc.w01).toFixed(2)} + ${(calc.f11*calc.w11).toFixed(2)}
       = <span class="highlight-green" style="font-size:1.2em">${calc.result.toFixed(4)}</span>
`;
            document.getElementById('calcDisplay').innerHTML = calcHTML;
        }
        
        function updateAll() {
            drawSourceImage();
            drawZoomView();
            updateCalculationDisplay();
        }
        
        // ============================================================
        // STEP BY STEP
        // ============================================================
        const steps = [
            {
                title: "Step 1: Koordinat Target",
                getContent: () => {
                    return `Kita ingin mencari nilai pixel pada koordinat:

<span class="highlight-yellow">x = ${currentX.toFixed(2)}</span>
<span class="highlight-yellow">y = ${currentY.toFixed(2)}</span>

Koordinat ini BUKAN integer, sehingga tidak ada pixel 
yang tepat di posisi tersebut.

Kita perlu <span class="highlight-green">INTERPOLASI</span> dari pixel-pixel terdekat!`;
                }
            },
            {
                title: "Step 2: Cari 4 Tetangga",
                getContent: () => {
                    const calc = calculateInterpolation();
                    return `Cari 4 pixel terdekat (integer coordinates):

x0 = floor(${currentX.toFixed(2)}) = <span class="highlight-green">${calc.x0}</span>
y0 = floor(${currentY.toFixed(2)}) = <span class="highlight-green">${calc.y0}</span>
x1 = x0 + 1 = <span class="highlight-green">${calc.x1}</span>
y1 = y0 + 1 = <span class="highlight-green">${calc.y1}</span>

4 Tetangga:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ f00 = pixel[${calc.x0}][${calc.y0}] = <span class="highlight-yellow">${calc.f00}</span> (Kiri-Atas)  â”‚
â”‚ f10 = pixel[${calc.x1}][${calc.y0}] = <span class="highlight-yellow">${calc.f10}</span> (Kanan-Atas) â”‚
â”‚ f01 = pixel[${calc.x0}][${calc.y1}] = <span class="highlight-yellow">${calc.f01}</span> (Kiri-Bawah) â”‚
â”‚ f11 = pixel[${calc.x1}][${calc.y1}] = <span class="highlight-yellow">${calc.f11}</span> (Kanan-Bawah)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`;
                }
            },
            {
                title: "Step 3: Hitung Fraksi (fx, fy)",
                getContent: () => {
                    const calc = calculateInterpolation();
                    return `Fraksi = jarak dari tepi kiri/atas cell

<span class="highlight-cyan">fx</span> = x - floor(x)
   = ${currentX.toFixed(2)} - ${calc.x0}
   = <span class="highlight-green">${calc.fx.toFixed(4)}</span>

<span class="highlight-cyan">fy</span> = y - floor(y)
   = ${currentY.toFixed(2)} - ${calc.y0}
   = <span class="highlight-green">${calc.fy.toFixed(4)}</span>

fx menunjukkan seberapa jauh ke KANAN
fy menunjukkan seberapa jauh ke BAWAH`;
                }
            },
            {
                title: "Step 4: Hitung Bobot (Weights)",
                getContent: () => {
                    const calc = calculateInterpolation();
                    return `Bobot = area persegi panjang diagonal

<span class="highlight-pink">w00</span> = (1-fx) Ã— (1-fy) = ${calc.w00.toFixed(4)}
<span class="highlight-pink">w10</span> = fx Ã— (1-fy)     = ${calc.w10.toFixed(4)}
<span class="highlight-pink">w01</span> = (1-fx) Ã— fy     = ${calc.w01.toFixed(4)}
<span class="highlight-pink">w11</span> = fx Ã— fy         = ${calc.w11.toFixed(4)}

Verifikasi: w00 + w10 + w01 + w11 
          = ${(calc.w00 + calc.w10 + calc.w01 + calc.w11).toFixed(4)} <span class="highlight-green">âœ“</span>

Semakin dekat ke pixel, semakin besar bobotnya!`;
                }
            },
            {
                title: "Step 5: Hasil Interpolasi",
                getContent: () => {
                    const calc = calculateInterpolation();
                    return `Formula: f(x,y) = Î£ (f_ij Ã— w_ij)

f00 Ã— w00 = ${calc.f00} Ã— ${calc.w00.toFixed(4)} = <span class="highlight-yellow">${(calc.f00*calc.w00).toFixed(4)}</span>
f10 Ã— w10 = ${calc.f10} Ã— ${calc.w10.toFixed(4)} = <span class="highlight-yellow">${(calc.f10*calc.w10).toFixed(4)}</span>
f01 Ã— w01 = ${calc.f01} Ã— ${calc.w01.toFixed(4)} = <span class="highlight-yellow">${(calc.f01*calc.w01).toFixed(4)}</span>
f11 Ã— w11 = ${calc.f11} Ã— ${calc.w11.toFixed(4)} = <span class="highlight-yellow">${(calc.f11*calc.w11).toFixed(4)}</span>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL = <span class="highlight-green" style="font-size:1.3em">${calc.result.toFixed(4)}</span>

Hasil interpolasi pada (${currentX.toFixed(2)}, ${currentY.toFixed(2)}) = <span class="highlight-green">${calc.result.toFixed(2)}</span>`;
                }
            }
        ];
        
        function showStep(stepIndex) {
            currentStep = stepIndex;
            
            // Update dots
            for (let i = 0; i < 5; i++) {
                const dot = document.getElementById(`dot${i}`);
                dot.classList.remove('active', 'completed');
                if (i < stepIndex) dot.classList.add('completed');
                if (i === stepIndex) dot.classList.add('active');
            }
            
            if (stepIndex >= 0 && stepIndex < steps.length) {
                document.getElementById('stepTitle').textContent = steps[stepIndex].title;
                document.getElementById('stepContent').innerHTML = steps[stepIndex].getContent();
            }
        }
        
        function startStepByStep() {
            currentStep = 0;
            showStep(0);
            
            // Auto advance
            let step = 0;
            const interval = setInterval(() => {
                step++;
                if (step < steps.length) {
                    showStep(step);
                } else {
                    clearInterval(interval);
                }
            }, 3000);
        }
        
        function resetDemo() {
            currentStep = -1;
            for (let i = 0; i < 5; i++) {
                document.getElementById(`dot${i}`).classList.remove('active', 'completed');
            }
            document.getElementById('stepTitle').textContent = 'Klik "Mulai Step-by-Step" untuk melihat proses';
            document.getElementById('stepContent').textContent = 'Geser slider X dan Y untuk memilih koordinat, lalu klik tombol untuk melihat proses interpolasi step-by-step.';
        }
        
        // ============================================================
        // CODE DISPLAY
        // ============================================================
        function showCode(type) {
            document.getElementById('codeDisplay').innerHTML = codeSnippets[type];
            
            // Update active tab
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // ============================================================
        // EVENT LISTENERS
        // ============================================================
        document.getElementById('xCoord').addEventListener('input', (e) => {
            currentX = parseFloat(e.target.value);
            document.getElementById('xValue').value = currentX.toFixed(2);
            updateAll();
        });
        
        document.getElementById('yCoord').addEventListener('input', (e) => {
            currentY = parseFloat(e.target.value);
            document.getElementById('yValue').value = currentY.toFixed(2);
            updateAll();
        });
        
        document.getElementById('xValue').addEventListener('change', (e) => {
            currentX = Math.max(0, Math.min(2.99, parseFloat(e.target.value)));
            document.getElementById('xCoord').value = currentX;
            updateAll();
        });
        
        document.getElementById('yValue').addEventListener('change', (e) => {
            currentY = Math.max(0, Math.min(2.99, parseFloat(e.target.value)));
            document.getElementById('yCoord').value = currentY;
            updateAll();
        });
        
        // Click on source canvas
        sourceCanvas.addEventListener('click', (e) => {
            const rect = sourceCanvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / 60;
            const y = (e.clientY - rect.top) / 60;
            
            currentX = Math.max(0, Math.min(2.99, x));
            currentY = Math.max(0, Math.min(2.99, y));
            
            document.getElementById('xCoord').value = currentX;
            document.getElementById('yCoord').value = currentY;
            document.getElementById('xValue').value = currentX.toFixed(2);
            document.getElementById('yValue').value = currentY.toFixed(2);
            
            updateAll();
        });
        
        // ============================================================
        // INIT
        // ============================================================
        showCode('interpolate');
        updateAll();
    </script>
</body>
</html>
